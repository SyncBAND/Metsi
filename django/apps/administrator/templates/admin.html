{% load static %}
<!DOCTYPE html>
<html lang="en" dir="">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Metsi</title>
    <link href="https://fonts.googleapis.com/css?family=Nunito:300,400,400i,600,700,800,900" rel="stylesheet">

    <link href="{% static 'api_auth/css/lite-purple.min.css' %}" rel="stylesheet">
    <link href="{% static 'api_auth/css/toastr.css' %}" rel="stylesheet">
    <script src="{% static 'api_auth/js/knockout-3.5.1.js' %}"></script>
    <script src="{% static 'api_auth/js/jquery-3.5.1.min.js' %}"></script>
    <script src="{% static 'api_auth/js/sammy.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'api_auth/js/toastr.js' %}"></script>

    <link href="https://demos.ui-lib.com/gull/dist-assets/css/themes/lite-purple.css" rel="stylesheet" />
    <link href="https://demos.ui-lib.com/gull/dist-assets/css/plugins/perfect-scrollbar.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://demos.ui-lib.com/gull/dist-assets/css/plugins/fontawesome-5.css" />
    <link href="https://demos.ui-lib.com/gull/dist-assets/css/plugins/metisMenu.min.css" rel="stylesheet" />

    <link rel="stylesheet" href="https://demos.ui-lib.com/gull/dist-assets/css/plugins/datatables.min.css">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
   integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
   crossorigin=""/>
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
    crossorigin=""></script>

    <style>
        @font-face {
            font-family: "iconsmind";
            src: url("{% static 'api_auth/css/iconsmind.eot?ioqkm7' %}");
            src: url("{% static 'api_auth/css/iconsmind.eot?ioqkm7#iefix' %}") format("embedded-opentype"),
            url("{% static 'api_auth/css/iconsmind.ttf?ioqkm7' %}") format("truetype"),
            url("{% static 'api_auth/css/iconsmind.woff?ioqkm7' %}") format("woff"),
            url("{% static 'api_auth/css/iconsmind.svg?ioqkm7#iconsmind' %}") format("svg");
            font-weight: normal;
            font-style: normal;
        }

        @import url("{% static 'api_auth/css/iconsmind.css' %}");
        .switch-overlay{
            display: none !important;
        }

        @media only screen and (max-width: 1150px){
            .sidebar-compact-switch {
                display: block;
            }
        }
        
    </style>
    
</head>

<body class="text-left">
    <div class="app-admin-wrap layout-sidebar-vertical sidebar-full">
        <div class="sidebar-panel">
            <div class="gull-brand pr-3 text-center mt-4 mb-2 d-flex justify-content-center align-items-center"><img class="pl-3" src="{% static 'api_auth/images/logo.png' %}" alt="Ad " />
                
                <!--  <span class=" item-name text-20 text-primary font-weight-700">GULL</span> -->
                <div class="sidebar-compact-switch ml-auto"><span></span></div>
            </div>
            <!--  user -->
            {% csrf_token %}
            <div class="scroll-nav ps ps--active-y" data-perfect-scrollbar="data-perfect-scrollbar" data-suppress-scroll-x="true">
                <div class="side-nav">
                    <div class="main-menu">
                        <ul class="metismenu" id="menu">
                            <li class="Ul_li--hover"><a data-bind="click: update_titles.bind($data, 'dashboard')"><i class="i-Bar-Chart text-20 mr-2 text-muted"></i><span class="item-name text-15 text-muted">Dashboard</span></a>
                            </li>
                            <!-- <li class="Ul_li--hover"><a class="has-arrow" href="#"><i class="i-Computer-Secure text-20 mr-2 text-muted"></i><span class="item-name text-15 text-muted">Ad Space</span></a>
                                <ul class="mm-collapse">
                                    <li class="item-name"><a data-bind="click: update_titles.bind($data, 'support')"><i class="nav-icon i-Data-Upload"></i><span class="item-name">Support</span></a></li>
                                </ul>
                            </li> -->
                            <li class="Ul_li--hover"><a class="has-arrow" href="#"><i class="i-Bell1 text-20 mr-2 text-muted"></i><span class="item-name text-15 text-muted">Enquiries</span></a>
                                <ul class="mm-collapse">
                                    <li class="item-name"><a data-bind="click: update_titles.bind($data, 'all-enquiries')"><i class="nav-icon i-Loading-3"></i><span class="item-name">All Enquiries</span></a></li>
                                    <li class="item-name"><a data-bind="click: update_titles.bind($data, 'pending-enquiries')"><i class="nav-icon i-Bell1"></i><span class="item-name">Pending</span></a></li>
                                    <li class="item-name"><a data-bind="click: update_titles.bind($data, 'reserved-enquiries')"><i class="nav-icon i-Line-Chart-2"></i><span class="item-name">Reserved</span></a></li>
                                    <li class="item-name"><a data-bind="click: update_titles.bind($data, 'approved-enquiries')"><i class="nav-icon i-Arrow-Next"></i><span class="item-name">Approved</span></a></li>
                                    <li class="item-name"><a data-bind="click: update_titles.bind($data, 'referred-enquiries')"><i class="nav-icon i-Arrow-Next"></i><span class="item-name">Referred</span></a></li>
                                    <li class="item-name"><a data-bind="click: update_titles.bind($data, 'resolved-enquiries')"><i class="nav-icon i-Arrow-Next"></i><span class="item-name">Resolved</span></a></li>
                                    <li class="item-name"><a data-bind="click: update_titles.bind($data, 'cancelled-enquiries')"><i class="nav-icon i-Loading"></i><span class="item-name">Cancelled</span></a></li>
                                </ul>
                            </li>
                            
                            
                            <li class="Ul_li--hover"><a class="has-arrow" href="#"><i class="i-Administrator text-20 mr-2 text-muted"></i><span class="item-name text-15 text-muted">Users</span></a>
                                <ul class="mm-collapse">
                                    <li class="item-name"><a data-bind="click: update_titles.bind($data, 'endusers')"><i class="nav-icon i-Checked-User"></i><span class="item-name">Endusers</span></a></li>
                                    <li class="item-name"><a data-bind="click: update_titles.bind($data, 'agents')"><i class="nav-icon i-Checked-User"></i><span class="item-name">Agents</span></a></li>
                                </ul>
                            </li>
                            
                        </ul>
                    </div>
                </div>
                <div class="ps__rail-x" style="left: 0px; bottom: 0px;">
                    <div class="ps__thumb-x" tabindex="0" style="left: 0px; width: 0px;"></div>
                </div>
                <div class="ps__rail-y" style="top: 0px; height: 404px; right: 0px;">
                    <div class="ps__thumb-y" tabindex="0" style="top: 0px; height: 325px;"></div>
                </div>
                <div class="ps__rail-x" style="left: 0px; bottom: 0px;">
                    <div class="ps__thumb-x" tabindex="0" style="left: 0px; width: 0px;"></div>
                </div>
                <div class="ps__rail-y" style="top: 0px; height: 404px; right: 0px;">
                    <div class="ps__thumb-y" tabindex="0" style="top: 0px; height: 325px;"></div>
                </div>
            </div>
            <!--  side-nav-close -->
        </div>
        <div class="switch-overlay"></div>
        <div class="main-content-wrap mobile-menu-content bg-off-white m-0">
            <header class="main-header bg-white d-flex justify-content-between p-2">
                <div class="header-toggle">
                    <div class="menu-toggle mobile-menu-icon">
                        <div></div>
                        <div></div>
                        <div></div>
                    </div>
                </div>
                <div class="header-part-right">
                    <!-- Full screen toggle--><i class="i-Full-Screen header-icon d-none d-sm-inline-block" data-fullscreen=""></i>
                    <!-- Logout--><i class="i-Close header-icon d-none d-sm-inline-block" data-bind="click: logout"></i>
                   
                </div>
            </header><!-- ============ Body content start ============= -->
            <div class="main-content pt-4">
                <div class="breadcrumb">
                    <h1 class="mr-2" data-bind="text: title()"></h1>
                    <ul>
                        <li data-bind="visible: sub_title() != '', text: sub_title()"></li>
                        <li data-bind="visible: sub_sub_title() != '', text: sub_sub_title()"></li>
                    </ul>
                </div>
                <div class="separator-breadcrumb border-top"></div>

                <!-- dashboard -->
                <div data-bind="visible: viewing() == 'dashboard'">
                    <div class="row">
                        <!-- ICON BG-->

                        <div class="col-lg-3 col-md-6 col-sm-6">
                            <div class="card card-icon-bg card-icon-bg-primary o-hidden mb-4">
                                <div class="card-body">
                                    <div class="ul-widget__row-v2" style="position: relative;">
                                        <div style="font-size: 50px;">
                                            <i class="i-Add-User"></i>
                                        </div>
                                        <div class="ul-widget__content-v2">
                                            <h4 class="heading mt-3" data-bind="text: enquiries"></h4><small class="text-muted m-0">Total Enquiries</small>
                                        </div>
                                    <div class="resize-triggers"><div class="expand-trigger"><div style="width: 200px; "></div></div><div class="contract-trigger"></div></div></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-3 col-md-6 col-sm-6">
                            <div class="card card-icon-bg card-icon-bg-primary o-hidden mb-4">
                                <div class="card-body">
                                    <div class="ul-widget__row-v2" style="position: relative;">
                                        <div style="font-size: 50px;">
                                            <i class="i-Checkout-Basket"></i>
                                        </div>
                                        <div class="ul-widget__content-v2">
                                            <h4 class="heading mt-3" data-bind="text: endusers"></h4><small class="text-muted m-0">Total Users</small>
                                        </div>
                                    <div class="resize-triggers"><div class="expand-trigger"><div style="width: 200px; "></div></div><div class="contract-trigger"></div></div></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-3 col-md-6 col-sm-6">
                            <div class="card card-icon-bg card-icon-bg-primary o-hidden mb-4">
                                <div class="card-body">
                                    <div class="ul-widget__row-v2" style="position: relative;">
                                        <div style="font-size: 50px;">
                                            <i class="i-Financial"></i>
                                        </div>
                                        <div class="ul-widget__content-v2">
                                            <h4 class="heading mt-3" data-bind="text: agents"></h4><small class="text-muted m-0">Total Agents</small>
                                        </div>
                                    <div class="resize-triggers"><div class="expand-trigger"><div style="width: 200px; "></div></div><div class="contract-trigger"></div></div></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-3 col-md-6 col-sm-6">
                            <div class="card card-icon-bg card-icon-bg-primary o-hidden mb-4">
                                <div class="card-body">
                                    <div class="ul-widget__row-v2" style="position: relative;">
                                        <div style="font-size: 50px;">
                                            <i class="i-Money-2"></i>
                                        </div>
                                        <div class="ul-widget__content-v2">
                                            <h4 class="heading mt-3" data-bind="text: support"></h4><small class="text-muted m-0">Support</small>
                                        </div>
                                    <div class="resize-triggers"><div class="expand-trigger"><div style="width: 200px; "></div></div><div class="contract-trigger"></div></div></div>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                    
                </div>

                
                <!-- all-enquiries -->
                <div data-bind="visible: title() == 'Enquiries'" class="row">
                
                    <div class="col-sm-12">
                        
                        <!-- table-->
                        <div class="card">
                            <div class="card-body">
                                <div class="ul-widget__head v-margin">
                                    <div class="ul-widget__head-label">
                                        <h3 class="ul-widget__head-title"></h3>
                                    </div>
                                    
                                    <div class="bg-white _r_btn border-0" data-bind="visible: detail_list().length > 0">
                                        <div class="input-group mb-3">
                                            <input data-bind="textInput: search" class="form-control" type="text" placeholder="Search" aria-label="Search" aria-describedby="basic-addon2">
                                            <div class="input-group-append"><button class="input-group-text" id="basic-addon2" data-bind="click: searching.bind($data, search())">Search</button></div>
                                            <div class="input-group-append"><button class="input-group-text" id="basic-addon2" data-bind="click: refresh_search.bind($data)">Refresh</button></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="ul-widget-body">
                                    <div class="ul-widget3">
                                        <div class="ul-widget6__item--table">
                                            <table class="table">
                                                <thead>
                                                    <tr class="ul-widget6__tr--sticky-th">

                                                        <th>Name</th>
                                                        <th>Problem</th>
                                                        <th>Status</th>
                                                        <th>Created</th>
                                                        <th>Area</th>
                                                        <th>Location</th>
                                                        <th>Reference</th>
                                                        <th></th>

                                                    </tr>
                                                </thead>
                                                <tbody data-bind="foreach: detail_list">
                                                    <!-- start tr-->
                                                    <tr>
                                                        <td data-bind="text: name"></td>
                                                        <td data-bind="text: problem"></td>
                                                        <td>
                                                            <span class="badge badge-pill badge-outline-danger p-2 m-1" data-bind="visible: current_status == 'Cancelled', text: current_status"></span>
                                                            <span class="badge badge-pill badge-outline-warning p-2 m-1" data-bind="visible: current_status == 'Pending', text: current_status"></span>
                                                            <span class="badge badge-pill badge-outline-success p-2 m-1" data-bind="visible: current_status == 'Resolved', text: current_status"></span>
                                                            <span class="badge badge-pill badge-outline-info p-2 m-1" data-bind="visible: current_status == 'Approved' || current_status == 'Referred' || current_status == 'Reserved', text: current_status"></span>
                                                        </td>
                                                        <td data-bind="text: $parent.timeSince(  new Date(enquiry_created)  ) +' ago'"></td>
                                                        <td data-bind="text: area"></td>
                                                        <td data-bind="text: location"></td>
                                                        <td data-bind="text: ref"></td>
                                                        <td style="text-align: center;">
                                                            <button class="btn btn-outline-primary mt-3 mb-3 m-sm-0 btn-rounded btn-sm" data-toggle="modal" data-target="#detailsModal"  data-bind="click: $parent.viewing_details.bind($data)"> See more</button>
                                                         </td>
                                                    </tr>
                                                    <!-- end tr-->
                                                </tbody>
                                            </table>
                                        </div>
                                        <nav aria-label="Page navigation example" data-bind="visible: detail_list().length > 0">
                                            <ul class="pagination">
                                                <li class="page-item" data-bind="click: paginate_prev.bind($data, first_page())"><a class="page-link"><i class="i-Previous"></i></a></li>
                                                <li class="page-item" data-bind="click: prev_item.bind($data)"><a class="page-link">Previous</a></li>
                                                <li class="page-item" data-bind="click: next_item.bind($data)"><a class="page-link">Next</a></li>
                                                <li class="page-item" data-bind="click: paginate_next.bind($data, last_page())"><a class="page-link"><i class="i-Next1"></i></a></li>
                                            </ul>
                                        </nav>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- view-details -->
                <!--  Details Modal -->
                <div class="modal fade" id="detailsModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle-2" aria-hidden="true" style="background: white;">
                    <div class="modal-dialog modal-dialog-centered" role="document" style="max-width: 100%; margin: 0px;">
                        <div class="modal-content" style="height: 100vh;">
                            
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel" data-bind="text: view_details()['name']"></h5>
                                <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                            </div>

                            <div class="modal-body row" data-bind="foreach: view_details">
                                <div class="col-lg-3 col-md-6 col-sm-6">
                                    <div class="card card-icon-bg card-icon-bg-primary o-hidden mb-4">
                                        <div class="card-body">
                                            <div class="ul-widget__row-v2" style="position: relative;">
                                                <div class="ul-widget__content-v2">
                                                    <h4 class="heading mt-3" data-bind="text: problem"></h4>
                                                    <small class="text-muted m-0">Problem</small>
                                                </div>
                                            <div class="resize-triggers"><div class="expand-trigger"><div style="width: 200px; "></div></div><div class="contract-trigger"></div></div></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-lg-3 col-md-6 col-sm-6">
                                    <div class="card card-icon-bg card-icon-bg-primary o-hidden mb-4">
                                        <div class="card-body">
                                            <div class="ul-widget__row-v2" style="position: relative;">
                                                <div class="ul-widget__content-v2">
                                                    <h4 class="heading mt-3" style="color: red;" data-bind="visible: current_status == 'Cancelled', text: current_status"></h4>
                                                    <h4 class="heading mt-3" style="color: #ffc107;" data-bind="visible: current_status == 'Pending', text: current_status"></h4>
                                                    <h4 class="heading mt-3" style="color: green;" data-bind="visible: current_status == 'Resolved', text: current_status"></h4>
                                                    <h4 class="heading mt-3" style="color: blue;" data-bind="visible: current_status == 'Approved' || current_status == 'Referred' || current_status == 'Reserved', text: current_status"></h4>
                                                    <small class="text-muted m-0">Status</small>
                                                </div>
                                            <div class="resize-triggers"><div class="expand-trigger"><div style="width: 200px; "></div></div><div class="contract-trigger"></div></div></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-lg-3 col-md-6 col-sm-6">
                                    <div class="card card-icon-bg card-icon-bg-primary o-hidden mb-4">
                                        <div class="card-body">
                                            <div class="ul-widget__row-v2" style="position: relative;">
                                                <div class="ul-widget__content-v2">
                                                    <h4 class="heading mt-3" data-bind="text: $parent.timeSince( new Date(enquiry_created) ) + ' ago'"></h4>
                                                    <small class="text-muted m-0">Created</small>
                                                </div>
                                            <div class="resize-triggers"><div class="expand-trigger"><div style="width: 200px; "></div></div><div class="contract-trigger"></div></div></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-lg-3 col-md-6 col-sm-6">
                                    <div class="card card-icon-bg card-icon-bg-primary o-hidden mb-4" style="cursor: pointer;">
                                        <div class="card-body">
                                            <div class="ul-widget__row-v2" style="position: relative;">
                                                <div class="ul-widget__content-v2">
                                                    <h4 class="heading mt-3" data-bind="text: 'View', click: $parent.locate.bind($data, latitude, longitude)"></h4>
                                                    <small class="text-muted m-0">Location</small>
                                                </div>
                                            <div class="resize-triggers"><div class="expand-trigger"><div style="width: 200px; "></div></div><div class="contract-trigger"></div></div></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-4">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="card-header d-flex align-items-center border-0" style="background: white;">
                                                <h4 class="float-left card-title m-0" data-bind="text: 'Reference: ' + ref" style="width: 90%;"></h4>
                                                <div class="dropdown dropleft text-right float-right" style="width: 10%;">
                                                    <button class="btn bg-gray-100" id="dropdownMenuButton1" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="nav-icon i-Gear-2"></i></button>
                                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                                        <a class="dropdown-item" data-toggle="modal" data-target="#decisionModal" style="cursor: pointer;" data-bind="visible: current_status == 'Pending', click: $parent.decision_modal.bind($data, enquiry_id_num, 'Approve Enquiry', 'Note: This action will approve the enquiry', 'enquiries-activity')">Approve Enquiry</a>
                                                        <a class="dropdown-item" data-toggle="modal" data-target="#decisionModal" style="cursor: pointer;" data-bind="visible: current_status == 'Pending', click: $parent.decision_modal.bind($data, enquiry_id_num, 'Cancel Enquiry', 'Note: This action will cancel the enquiry', 'cancel')">Cancel Enquiry</a>
                                                        <a class="dropdown-item" data-toggle="modal" data-target="#decisionModal" style="cursor: pointer;" data-bind="visible: current_status == 'Reserved', click: $parent.decision_modal.bind($data, enquiry_id_num, 'Cancel Reservation', 'Note: This action will cancel the reservation', 'cancel')">Cancel Reservation</a>
                                                        <a class="dropdown-item" data-toggle="modal" data-target="#historyModal" style="cursor: pointer;" data-bind="click: $parent.view_history.bind($data, enquiry_id_num, 'enquiry')">View Details</a>
                                                        <a class="dropdown-item" data-toggle="modal" data-target="#chatListModal" style="cursor: pointer;" data-bind="click: $parent.view_history.bind($data, enquiry_id_num, 'chat')" style="cursor: pointer;" >Chats</a>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="ul-widget-app__recent-messages">
                                                <div class="ul-widget-app__row-comments mb-0">
                                                    <div class="ul-widget-app__comment">
                                                        <div class="ul-widget-app__profile-title">
                                                            <h6 class="heading">Area</h6>
                                                            <p class="mb-2" data-bind="text: area"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="ul-widget-app__row-comments mb-0">
                                                    <div class="ul-widget-app__comment">
                                                        <div class="ul-widget-app__profile-title">
                                                            <h6 class="heading">Position</h6>
                                                            <p class="mb-2" data-bind="text: position"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="ul-widget-app__row-comments mb-0">
                                                    <div class="ul-widget-app__comment">
                                                        <div class="ul-widget-app__profile-title">
                                                            <h6 class="heading">Location</h6>
                                                            <p class="mb-2" data-bind="text: location"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="ul-widget-app__row-comments border-bottom-gray-200 mb-0" data-bind="click: $parent.view_user.bind($data, enquiry_id_num, 'enquiry', 'user')">
                                                    <div class="ul-widget-app__comment">
                                                        <div class="ul-widget-app__profile-title">
                                                            <h6 class="heading">User</h6>
                                                            <p class="mb-2" data-bind="text: enduser_name"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="ul-widget-app__row-comments border-bottom-gray-200 mb-0" data-bind="visible: current_status != 'Pending', click: $parent.view_user.bind($data, enquiry_id_num, 'enquiry', 'agent')">
                                                    <div class="ul-widget-app__comment">
                                                        <div class="ul-widget-app__profile-title">
                                                            <h6 class="heading">Agent</h6>
                                                            <p class="mb-2" data-bind="text: agent_name"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="ul-widget-app__row-comments mb-0">
                                                    <div class="ul-widget-app__comment">
                                                        <div class="ul-widget-app__profile-title">
                                                            <h6 class="heading">Skill needed</h6>
                                                            <p class="mb-2" data-bind="text: skill"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="ul-widget-app__row-comments mb-0">
                                                    <div class="ul-widget-app__comment">
                                                        <div class="ul-widget-app__profile-title">
                                                            <h6 class="heading">Description</h6>
                                                            <p class="mb-2" data-bind="text: description"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="ul-widget-app__row-comments mb-0">
                                                    <div class="ul-widget-app__comment">
                                                        <div class="ul-widget-app__profile-title">
                                                            <h6 class="heading">Status details</h6>
                                                            <p class="mb-2" data-bind="text: status_details"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="ul-widget-app__row-comments mb-0">
                                                    <div class="ul-widget-app__comment">
                                                        <div class="ul-widget-app__profile-title">
                                                            <h6 class="heading">Enquiry created</h6>
                                                            <p class="mb-2" data-bind="text: $parent.format_date( new Date(enquiry_created) )"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="ul-widget-app__row-comments mb-0">
                                                    <div class="ul-widget-app__comment">
                                                        <div class="ul-widget-app__profile-title">
                                                            <h6 class="heading">Last modified</h6>
                                                            <p class="mb-2" data-bind="text: $parent.format_date( new Date(modified) )"></p>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-4">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="card-title">Images</div>
                                            <div class="ul-widget-app__recent-messages" data-bind="foreach: images">
                                                <div class="card mb-4 o-hidden" data-toggle="modal" data-target="#imageModal" data-bind="click: $parents[1].imageOpenModal.bind($data)">
                                                    <img class="card-img-top" data-bind="attr: {'src': $data}">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!--  Image Modal -->
                <div class="modal fade" id="imageModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle-2" aria-hidden="true" style="background: white;">
                    <div class="modal-dialog modal-dialog-centered" role="document" style="max-width: 100%; margin: 0px;">
                        <div class="modal-content" style="height: 100vh;">
                            <div class="modal-header">
                                <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                            </div>
                            <div class="modal-body" data-bind="attr: {'style': 'background-image: url('+imageModal()+'); background-size: 100% 100%; background-repeat: no-repeat;'}">
                                
                            </div>
                        </div>
                    </div>
                </div>

                <!--  Decision Modal -->
                <div class="modal fade" id="decisionModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle-2" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document" >
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" data-bind="text: decision_details()['title']"></h5>
                                <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                            </div>
                            <div class="modal-body" style="text-align: center;">
                                <h4 data-bind="text: decision_details()['details']"></h4>
                                <br>

                                <form class="row">
                                    <div class="col-md-12">
                                                
                                        <div class="input-group">
                                            <div class="input-group-prepend"><span class="input-group-text">Reason</span></div>
                                            <textarea data-bind="textInput: decision_reason" class="form-control" aria-label="With textarea" rows="3" required></textarea>
                                        </div>
                                                
                                    </div>
                                </form>

                            </div>
                            
                            <div class="modal-footer">
                                <button class="btn btn-primary ml-2" data-bind="click: continue_decision_modal" type="button">Continue</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!--  History Modal -->
                <div class="modal fade" id="historyModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle-2" aria-hidden="true" style="background: white;">
                    <div class="modal-dialog modal-dialog-centered" role="document" style="max-width: 100%; margin: 0px;">
                        <div class="modal-content" style="height: 100vh;">
                            <div class="modal-header">
                                <h5 class="modal-title"></h5>
                                <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                            </div>
                            <div class="modal-body">
                                <div class="ul-widget__head v-margin">
                                    <div class="ul-widget__head-label">
                                        <h3 class="ul-widget__head-title">Viewing History</h3>
                                    </div>
                                    
                                    <div class="bg-white _r_btn border-0" data-bind="visible: detail_list_history().length > 0">
                                        <div class="input-group mb-3">
                                            <input data-bind="textInput: search_history" class="form-control" type="text" placeholder="Search" aria-label="Search" aria-describedby="basic-addon2">
                                            <div class="input-group-append"><button class="input-group-text" id="basic-addon2" data-bind="click: searching_history.bind($data, search_history())">Search</button></div>
                                            <div class="input-group-append"><button class="input-group-text" id="basic-addon2" data-bind="click: refresh_search_history.bind($data)">Refresh</button></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="ul-widget-body">
                                    <div class="ul-widget3">
                                        <div class="ul-widget6__item--table">
                                            <table class="table">
                                                <thead>
                                                    <tr class="ul-widget6__tr--sticky-th">

                                                        <th>Modified</th>
                                                        <th>User Name</th>
                                                        <th>User type</th>
                                                        <th>Previous status</th>
                                                        <th>Previous status details</th>
                                                        <th>New status</th>
                                                        <th>New status details</th>
                                                        <th>Difference in time since last modified</th>
                                                        <th>Exact difference in time since last modified</th>
                                                        
                                                    </tr>
                                                </thead>
                                                <tbody data-bind="foreach: detail_list_history">
                                                    <!-- start tr-->
                                                    <tr>
                                                        <td data-bind="text: $parent.format_date(created)"></td>
                                                        <td data-bind="text: user_name"></td>
                                                        <td data-bind="text: mode"></td>
                                                        <td>
                                                            <span class="badge badge-pill badge-outline-danger p-2 m-1" data-bind="visible: previous_status_ == 'Cancelled', text: previous_status_"></span>
                                                            <span class="badge badge-pill badge-outline-warning p-2 m-1" data-bind="visible: previous_status_ == 'Pending', text: previous_status_"></span>
                                                            <span class="badge badge-pill badge-outline-success p-2 m-1" data-bind="visible: previous_status_ == 'Resolved', text: previous_status_"></span>
                                                            <span class="badge badge-pill badge-outline-info p-2 m-1" data-bind="visible: previous_status_ == 'Approved' || previous_status_ == 'Referred' || previous_status_ == 'Reserved', text: previous_status_"></span>
                                                        </td>
                                                        <td data-bind="text: previous_status_details"></td>
                                                        <td>
                                                            <span class="badge badge-pill badge-outline-danger p-2 m-1" data-bind="visible: current_status == 'Cancelled', text: current_status"></span>
                                                            <span class="badge badge-pill badge-outline-warning p-2 m-1" data-bind="visible: current_status == 'Pending', text: current_status"></span>
                                                            <span class="badge badge-pill badge-outline-success p-2 m-1" data-bind="visible: current_status == 'Resolved', text: current_status"></span>
                                                            <span class="badge badge-pill badge-outline-info p-2 m-1" data-bind="visible: current_status == 'Approved' || current_status == 'Referred' || current_status == 'Reserved', text: current_status"></span>
                                                        </td>
                                                        <td data-bind="text: status_details"></td>
                                                        <td data-bind="text: $parent.timeSince(new Date(previous_enquiry_update), new Date(created))"></td>
                                                        <td data-bind="text: $parent.difference_in_time(new Date(previous_enquiry_update), new Date(created))"></td>
                                                    </tr>
                                                    <!-- end tr-->
                                                </tbody>
                                            </table>
                                        </div>
                                        <nav aria-label="Page navigation example" data-bind="visible: detail_list_history().length > 0">
                                            <ul class="pagination">
                                                <li class="page-item" data-bind="click: paginate_prev_history.bind($data, first_page_history())"><a class="page-link"><i class="i-Previous"></i></a></li>
                                                <li class="page-item" data-bind="click: prev_item_history.bind($data)"><a class="page-link">Previous</a></li>
                                                <li class="page-item" data-bind="click: next_item_history.bind($data)"><a class="page-link">Next</a></li>
                                                <li class="page-item" data-bind="click: paginate_next_history.bind($data, last_page_history())"><a class="page-link"><i class="i-Next1"></i></a></li>
                                            </ul>
                                        </nav>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!--  User Modal -->
                <div class="modal fade" id="userModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle-2" aria-hidden="true" style="background: white;">
                    <div class="modal-dialog modal-dialog-centered" role="document" style="max-width: 100%; margin: 0px;">
                        <div class="modal-content" style="height: 100vh;">
                            <div class="modal-header">
                                <h5 class="modal-title" data-bind="text: user_details()['user_name']"></h5>
                                <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                            </div>
                            <div class="modal-body row">

                                <div class="col-md-12" data-bind="foreach: user_details">
                                            
                                    <div class="card user-profile o-hidden mb-4">
                                        <div class="header-cover" style="background-image: url('https://demos.ui-lib.com/gull/dist-assets/images/photo-wide-4.jpg')"></div>
                                        <div class="user-info"><img class="profile-picture avatar-lg mb-2" data-bind="attr: {'src': profile_pic}" alt="" />
                                            <p class="m-0 text-24" data-bind="text: user_name"></p>
                                            <p class="text-muted m-0" data-bind="text: title"></p>
                                        </div>
                                        <div class="card-body">
                                            <ul class="nav nav-tabs profile-nav mb-4" id="profileTab" role="tablist">
                                                <li class="nav-item"><a class="nav-link active" id="timeline-tab" data-toggle="tab" href="#timeline" role="tab" aria-controls="timeline" aria-selected="false">Timeline</a></li>
                                                <li class="nav-item"><a class="nav-link" id="about-tab" data-toggle="tab" href="#about" role="tab" aria-controls="about" aria-selected="true">About</a></li>
                                            </ul>
                                            <div class="tab-content" id="profileTabContent">
                                                <div class="tab-pane fade active show" id="timeline" role="tabpanel" aria-labelledby="timeline-tab">
                                                    <ul class="timeline clearfix">
                                                        <li class="timeline-line"></li>
                                                        
                                                        <li class="timeline-item">
                                                            <div class="timeline-badge"><img class="badge-img" data-bind="attr: {'src': profile_pic}" alt="" /></div>
                                                            <div class="timeline-card card">
                                                                <div class="card-body" data-bind="visible: is_email_verified">
                                                                    <div class="mb-1"><strong class="mr-1" data-bind="text: user_name" style="color: green;"></strong> verified email
                                                                        <p class="text-muted" data-bind="text: $parent.timeSince(new Date(date_email_verified)) + ' ago'"></p>
                                                                    </div>
                                                                </div>
                                                                <div class="card-body" data-bind="visible: !is_email_verified">
                                                                    <div class="mb-1"><strong class="mr-1" data-bind="text: user_name" style="color: red;"></strong> email is not verified
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </li>
                                                    </ul>
                                                    
                                                    <ul class="timeline clearfix">
                                                        <li class="timeline-line"></li>
                                                        <li class="timeline-group text-center">
                                                            <button class="btn btn-icon-text btn-warning"><i class="i-Calendar-4"></i> <span data-bind="text: $parent.format_date(date_joined)"></span>
                                                            </button>
                                                        </li>
                                                    </ul>
                                                </div>

                                                <div class="tab-pane fade" id="about" role="tabpanel" aria-labelledby="about-tab">

                                                    <span data-bind="visible: title == 'Agent' && !active">
                                                        <h4>Activate agent</h4>
                                                        <hr />
                                                        <div class="row">
                                                        
                                                            <div class="col-md-4 col-6">
                                                                <button class="btn btn-icon-text btn-success" data-bind="click: $parent.activate.bind($data, user_id)"><i class="i-Yes text-16 mr-1"></i> Activate</button>
                                                            </div>

                                                        </div>
                                                        <hr />
                                                    </span>

                                                    <h4>Personal Information</h4>
                                                    <p data-bind="text: title"></p>
                                                    <hr />
                                                    <div class="row">
                                                    
                                                        <div class="col-md-4 col-6">
                                                            <div class="mb-4" style="cursor: pointer" data-bind="visible: is_email_verified">
                                                                <p class="text-primary mb-1"><i class="i-Email text-16 mr-1"></i> Email</p><span data-bind="text: email"></span>
                                                            </div>
                                                            <div class="mb-4" data-bind="visible: !is_email_verified">
                                                                <p class="text-primary mb-1"><i class="i-Email text-16 mr-1"></i> Email</p><span data-bind="text: 'Not verified as yet'"></span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <hr />
                                                    
                                                </div>
                                                
                                                
                                            </div>
                                        </div>
                                    </div><!-- end of main-content -->
                                            
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                
                <!--  Email Modal -->
                <div class="modal fade" id="emailModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle-2" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered" role="document" >
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" data-bind="text: 'Email'"></h5>
                                <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                            </div>
                            <div class="modal-body" >

                                <form class="row">
                                    <div class="col-md-12">

                                        <div class="input-group">
                                            <div class="input-group-prepend"><span class="input-group-text">Subject</span></div>
                                            <input class="form-control" data-bind="textInput: subject" type="text" placeholder="" />
                                        </div>
                                        <small class="ul-form__text form-text">
                                            Less than 50 characters
                                        </small>
                                        <br/>
                                        <div class="input-group">
                                            <div class="input-group-prepend"><span class="input-group-text">Message</span></div>
                                            <textarea data-bind="textInput: decision_reason" class="form-control" aria-label="With textarea" rows="3" required></textarea>
                                        </div>
                                                
                                    </div>
                                </form>

                            </div>
                            
                            <div class="modal-footer">
                                <button class="btn btn-primary ml-2" data-bind="click: continue_decision_modal" type="button">Send</button>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- chatlist -->
                <div class="modal fade" id="chatListModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle-2" aria-hidden="true" style="background: white;">
                    <div class="modal-dialog modal-dialog-centered" role="document" style="max-width: 100%; margin: 0px;">
                        <div class="modal-content" style="height: 100vh;">
                            <div class="modal-header">
                                <h5 class="modal-title"></h5>
                                <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                            </div>
                            <div class="modal-body">
                                <div class="ul-widget__head v-margin">
                                    <div class="ul-widget__head-label">
                                        <h3 class="ul-widget__head-title">Chat list</h3>
                                    </div>
                                    
                                    <div class="bg-white _r_btn border-0" data-bind="visible: chat_list().length > 0">
                                        <div class="input-group mb-3">
                                            <input data-bind="textInput: search_history" class="form-control" type="text" placeholder="Search" aria-label="Search" aria-describedby="basic-addon2">
                                            <div class="input-group-append"><button class="input-group-text" id="basic-addon2" data-bind="click: searching_history.bind($data, search_history())">Search</button></div>
                                            <div class="input-group-append"><button class="input-group-text" id="basic-addon2" data-bind="click: refresh_search_history.bind($data)">Refresh</button></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="ul-widget-body">
                                    <div class="ul-widget3">
                                        <div class="ul-widget6__item--table">
                                            <table class="table">
                                                <thead>
                                                    <tr class="ul-widget6__tr--sticky-th">
                                                        
                                                        <th>User</th>
                                                        <th>Agent</th>
                                                        <th>Chat created</th>
                                                        <th>Last message</th>
                                                        <th>Last message sent by</th>
                                                        <th>Last message sent at</th>
                                                        <th></th>
                                                        
                                                    </tr>
                                                </thead>
                                                <tbody data-bind="foreach: chat_list">
                                                    <!-- start tr-->
                                                    <tr>
                                                        <td data-bind="text: creator_name"></td>
                                                        <td data-bind="text: respondent_name"></td>
                                                        <td data-bind="text: $parent.format_date(created)"></td>
                                                        <td data-bind="text: last_message"></td>
                                                        <td data-bind="visible: last_message_sent_by == respondent">Agent</td>
                                                        <td data-bind="visible: last_message_sent_by == creator">Enduser</td>
                                                        <td data-bind="text: $parent.format_date(modified)"></td>
                                                        <td style="text-align: center;">
                                                            <button class="btn btn-outline-primary mt-3 mb-3 m-sm-0 btn-rounded btn-sm" data-toggle="modal" data-target="#chatsModal"  data-bind="click: $parent.viewing_chats.bind($data, id)"> Messages</button>
                                                        </td>

                                                    </tr>
                                                    <!-- end tr-->
                                                </tbody>
                                            </table>
                                        </div>
                                        <nav aria-label="Page navigation example" data-bind="visible: chat_list().length > 0">
                                            <ul class="pagination">
                                                <li class="page-item" data-bind="click: paginate_prev_history.bind($data, first_page_history())"><a class="page-link"><i class="i-Previous"></i></a></li>
                                                <li class="page-item" data-bind="click: prev_item_history.bind($data)"><a class="page-link">Previous</a></li>
                                                <li class="page-item" data-bind="click: next_item_history.bind($data)"><a class="page-link">Next</a></li>
                                                <li class="page-item" data-bind="click: paginate_next_history.bind($data, last_page_history())"><a class="page-link"><i class="i-Next1"></i></a></li>
                                            </ul>
                                        </nav>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- chat -->
                <div class="modal fade" id="chatsModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle-2" aria-hidden="true" style="background: white;">
                    <div class="modal-dialog modal-dialog-centered" role="document" style="max-width: 100%; margin: 0px;">
                        <div class="modal-content" style="height: 100vh;">
                            <div class="modal-header">
                                <h5 class="modal-title"></h5>
                                <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                            </div>
                            <div class="modal-body">
                                <div class="card chat-sidebar-container" data-sidebar-container="chat">
                                    
                                    <div class="chat-content-wrap" data-sidebar-content="chat">
                                        <div class="d-flex pl-3 pr-3 pt-2 pb-2 o-hidden box-shadow-1 chat-topbar">
                                            <p class="m-0 text-title text-16 flex-grow-1">Chats</p>
                                        </div>
                                        <div data-bind="foreach: chats" class="chat-content perfect-scrollbar" data-suppress-scroll-x="true" style="height: calc(100vh - 200px);">

                                            <span data-bind="visible: mode == 'ENDUSER'">
                                                <div class="d-flex mb-4">
                                                    <div class="message flex-grow-1">
                                                        <div class="d-flex">
                                                            <p class="mb-1 text-title text-16 flex-grow-1" data-bind="text: creator_name"></p><span class="text-small text-muted" data-bind="text: $parent.format_date(created)"></span>
                                                        </div>
                                                        <p class="m-0" data-bind="text: message"></p>
                                                    </div>
                                                    <img class="avatar-sm rounded-circle ml-3" data-bind="attr: {'src': creator_profile_pic}" alt="alt" />
                                                </div>
                                            </span>

                                            <span data-bind="visible: mode == 'AGENT'">
                                                <div class="d-flex mb-4 user">
                                                    <img class="avatar-sm rounded-circle mr-3" data-bind="attr: {'src': respondent_profile_pic}" alt="alt" />
                                                    <div class="message flex-grow-1">
                                                        <div class="d-flex">
                                                            <p class="mb-1 text-title text-16 flex-grow-1" data-bind="text: respondent_name"></p><span class="text-small text-muted" data-bind="text: $parent.format_date(created)"></span>
                                                        </div>
                                                        <p class="m-0" data-bind="text: message"></p>
                                                    </div>
                                                </div>
                                            </span>
                                            
                                        </div>
                                        
                                    </div>
                                </div><!-- end of main-content -->
                            </div>
                        </div>
                    </div>
                </div>




                <!-- users -->
                <div data-bind="visible: title() == 'Users'">

                    <div class="ul-widget__head v-margin row" data-bind="visible: users">

                        <div class="col-md-7">
                        </div>

                        <div class="col-md-5">
                            <div class="bg-white _r_btn border-0" data-bind="visible: users().length > 0">
                                <div class="input-group mb-3">
                                    <input data-bind="textInput: search" class="form-control" type="text" placeholder="Search" aria-label="Search" aria-describedby="basic-addon2">
                                    <div class="input-group-append"><button class="input-group-text" id="basic-addon2" data-bind="click: searching.bind($data, search())">Search</button></div>
                                    <div class="input-group-append"><button class="input-group-text" id="basic-addon2" data-bind="click: refresh_search.bind($data)">Refresh</button></div>
                                </div>
                            </div>
                        </div>
                        
                    <br/>
                    </div>

                    <div class="row" data-bind="foreach: users">
                        
                        <div class="col-md-3">
                            <br/>
                            <div class="card card-profile-1 mb-4">
                                <div class="card-body text-center">
                                    <div class="avatar box-shadow-2 mb-3"><img data-bind="attr: {'src': profile_pic}" alt="" /></div>
                                    <h5 class="m-0" data-bind="text: user_name"></h5>
                                    <p class="mt-0 text-muted" data-bind="text: title"></p>
                                    <p data-bind="visible: active" style="color: green;"><i class="i-Yes"></i> Verified</p>
                                    <p data-bind="visible: !active" style="color: red;"><i class="i-Close"></i> Not Verified</p>
                                    <button class="btn btn-primary btn-rounded" data-toggle="modal" data-target="#userModal" data-bind="click: $parent.user_modal.bind($data)">See more</button>
                                    <div class="card-socials-simple mt-4">
                                        <a data-toggle="modal" data-target="#emailModal" data-bind="visible: is_email_verified, click: $parent.decision_modal.bind($data, user_id, 'Email', 'Email', 'email')" style="cursor: pointer;"><i class="i-Mail"></i></a>
                                        <span data-bind="visible: !is_email_verified">Email not verified</span>
                                    </div>
                                </div>
                            </div>
                            <br/>
                        </div>
                    </div>

                    <nav aria-label="Page navigation example" data-bind="visible: users().length > 0">
                        <ul class="pagination">
                            <li class="page-item" data-bind="click: paginate_prev.bind($data, first_page())"><a class="page-link"><i class="i-Previous"></i></a></li>
                            <li class="page-item" data-bind="click: prev_item.bind($data)"><a class="page-link">Previous</a></li>
                            <li class="page-item" data-bind="click: next_item.bind($data)"><a class="page-link">Next</a></li>
                            <li class="page-item" data-bind="click: paginate_next.bind($data, last_page())"><a class="page-link"><i class="i-Next1"></i></a></li>
                        </ul>
                    </nav>

                </div><!-- end of main-content -->

            </div>
            
            
            <div class="sidebar-overlay open"></div><!-- Footer Start -->
            <div class="flex-grow-1"></div>
            <div class="app-footer">
                <div class="footer-bottom pt-3 d-flex flex-column flex-sm-row align-items-center">
                    <span class="flex-grow-1"></span>
                    <div class="d-flex align-items-center">
                        <img class="logo" src="../../dist-assets/images/logo.png" alt="">
                        <div>
                            <p class="m-0">&copy; <span id="current_year"> Metsi</p>
                            <p class="m-0">All rights reserved</p>
                        </div>
                    </div>
                </div>
            </div>
            <!-- fotter end -->
        </div>
    </div>

    <!-- ============ Search UI End ============= -->
    <script src="https://demos.ui-lib.com/gull/dist-assets/js/plugins/jquery-3.3.1.min.js"></script>
    <script src="https://demos.ui-lib.com/gull/dist-assets/js/plugins/bootstrap.bundle.min.js"></script>
    <script src="https://demos.ui-lib.com/gull/dist-assets/js/plugins/perfect-scrollbar.min.js"></script>
    <script src="https://demos.ui-lib.com/gull/dist-assets/js/scripts/tooltip.script.min.js"></script>
    <script src="https://demos.ui-lib.com/gull/dist-assets/js/scripts/script.min.js"></script>
    <script src="https://demos.ui-lib.com/gull/dist-assets/js/scripts/script_2.min.js"></script>
    <script src="https://demos.ui-lib.com/gull/dist-assets/js/scripts/sidebar.large.script.min.js"></script>
    <script src="https://demos.ui-lib.com/gull/dist-assets/js/plugins/feather.min.js"></script>
    <script src="https://demos.ui-lib.com/gull/dist-assets/js/plugins/metisMenu.min.js"></script>
    <script src="https://demos.ui-lib.com/gull/dist-assets/js/scripts/layout-sidebar-vertical.min.js"></script>
    <script src="https://demos.ui-lib.com/gull/dist-assets/js/plugins/echarts.min.js"></script>
    <script src="https://demos.ui-lib.com/gull/dist-assets/js/scripts/echart.options.min.js"></script>
    <script src="https://demos.ui-lib.com/gull/dist-assets/js/plugins/datatables.min.js"></script>
    <script>

        var date_ = new Date();
		var year_ = date_.getFullYear();
		document.getElementById("current_year").innerHTML = year_;

        function AdminViewModel() {

            self = this;

            self.title = ko.observable("Dashboard");
            self.sub_title = ko.observable("");
            self.sub_sub_title = ko.observable("");

            self.first_name = ko.observable("");
            self.cell = ko.observable("");
            self.confirm_password = ko.observable("");

            self.pass_text = ko.observable("password");

            var get_query = function (url) {

                if( url.includes('?') )
                    url = url + '&mode=ADMIN'
                else
                    url = url + '?mode=ADMIN'

                return $.ajax({
                    url: url,
                    type: "GET",
                    dataType: "json",
                    async: false,
                    contentType: "application/json; charset=utf-8"
                });
            };

            var post_query = function (url, formData, type='json') {
                console.log(formData)
                const csrftoken = '{{csrf_token}}';

                if(type == 'file')
                    return $.ajax({
                        url: url,
                        type: "POST",
                        headers: {
                            'X-CSRFToken': csrftoken
                        },
                        processData: false,
                        contentType: false,
                        data: formData
                    });
                else{
                    return $.ajax({
                        data: formData,
                        headers: {
                            'X-CSRFToken': csrftoken
                        },
                        url: url,
                        type: "POST",
                        dataType: "json",
                    });
                }
                
            };

            this.change_pass_text = function() {
                if( self.pass_text() == "password")
                    self.pass_text("text")
                else
                    self.pass_text("password")
            }

            self.format_date = function( value ) {

                if (value){
                    var options = { year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric' };
                    var date_time  = new Date(value);
                    value = date_time.toLocaleDateString("en-US", options);
                }
                else
                    value = '-';
                return `${value}`
                
            };

            self.difference_in_time = function(first_date, last_date){

                const diffDays = parseInt((last_date - first_date) / (1000 * 60 * 60 * 24));
                const diffHrs = parseInt(Math.abs(last_date - first_date) / (1000 * 60 * 60) % 24);
                const diffMins = parseInt(Math.abs(last_date.getTime() - first_date.getTime()) / (1000 * 60) % 60);
                const diffSecs = parseInt(Math.abs(last_date.getTime() - first_date.getTime()) / (1000) % 60); 

                return (diffDays + " days, " + diffHrs + " hours, " + diffMins + " minutes, " + diffSecs + " seconds");
            }

            self.activate = function(id){

                formData = {
                    'user_id': id,
                    'mode': 'ADMIN'
                };
                
                post_query('/api/agent/activate_agent/', formData).then((result)=>{
                    console.log(result)
                    self.user_details(result)

                    toastr.success("Activated", "Done", {
                        hideDuration: 3000
                    });
                }, (err)=>{
                    toastr.warning(JSON.stringify(err), "Error", {
                        hideDuration: 3000
                    });
                })

            }

            self.timeSince = function(date, lastest=new Date()) {

                var seconds = Math.floor((lastest - date) / 1000);

                var interval = seconds / 31536000;

                if (interval > 1) {
                    return Math.floor(interval) + " years";
                }
                interval = seconds / 2592000;
                if (interval > 1) {
                    return Math.floor(interval) + " months";
                }
                interval = seconds / 86400;
                if (interval > 1) {
                    return Math.floor(interval) + " days";
                }
                interval = seconds / 3600;
                if (interval > 1) {
                    return Math.floor(interval) + " hours";
                }
                interval = seconds / 60;
                if (interval > 1) {
                    return Math.floor(interval) + " minutes";
                }
                return Math.floor(seconds) + " seconds";

            }

            self.viewing = ko.observable('');

            self.enquiries = ko.observable(0);
            self.agents = ko.observable(0);
            self.endusers = ko.observable(0);
            self.support = ko.observable(0);

            self.loaded_dashboard = ko.observable(false)

            self.users = ko.observableArray()
            self.user_details = ko.observableArray()

            self.detail_list = ko.observableArray([])
            self.detail_list_history = ko.observableArray([])
            self.chat_list = ko.observableArray([])
            self.chats = ko.observableArray([])
            
            self.next = ko.observable()
            self.prev = ko.observable()
            self.first_page = ko.observable('')
            self.last_page = ko.observable(1)
            self.current = ko.observable('')
            self.search = ko.observable('')

            self.next_history = ko.observable()
            self.prev_history = ko.observable()
            self.first_page_history = ko.observable('')
            self.last_page_history = ko.observable(1)
            self.current_history = ko.observable('')
            self.search_history = ko.observable('')

            self.view_details = ko.observableArray()

            self.decision_details = ko.observableArray()
            self.decision_reason = ko.observable('')

            self.subject = ko.observable('')
            self.skillsModal = ko.observable('')

            self.skills = ko.observableArray()
            self.edit_skills = function(data, type){
                console.log(data)
            }
            self.open_skills_or_parts = function(url, title){

                self.skillsModal(title)

                get_query(url).then((result)=>{
                    self.skills(result)
                }, (err)=>{
                    toastr.warning(JSON.stringify(err), "Error", {
                        hideDuration: 3000
                    });
                })
                    
            }

            self.decision_modal = function(id, title, details, type){

                self.decision_details({
                    id: id,
                    title: title,
                    details: details,
                    type: type
                })
                
            }

            self.user_modal = function(data){
                self.user_details(data)
            }

            self.continue_decision_modal = function(){
                
                let current_status = ''
                let url = ''
                let formData = {}

                if(self.decision_details().type == 'cancel'){
                    if(self.decision_reason().length < 10)
                        return toastr.warning("Reason is too short", "Cancel error", {
                                hideDuration: 3000
                            });
                    
                    url = '/api/enquiries-activity/'
                    current_status = 'Cancelled'

                    formData = {
                        'enquiry_id': self.decision_details().id,
                        'user': '1',
                        'status_details': self.decision_reason(),
                        'current_status': current_status,
                        'previous_skill_needed': '1',
                        'mode': 'ADMIN'
                    };
                }
                else if(self.decision_details().type == 'enquiries-activity'){
                    url = '/api/enquiries-activity/'

                    formData = {
                        'enquiry_id': self.decision_details().id,
                        'user': '1',
                        'status_details': self.decision_reason(),
                        'current_status': 'Approved',
                        'previous_skill_needed': '1',
                        'mode': 'ADMIN'
                    };
                }
                else{
                    url = '/api/user-profile/email/'

                    if(self.decision_reason().length < 10)
                        return toastr.warning("Email is too short", "Email error", {
                                hideDuration: 3000
                            });

                    formData = {
                        'user_id': self.decision_details().id,
                        'subject': self.subject(),
                        'message': self.decision_reason(),
                        'mode': 'ADMIN'
                    };
                }
                
                post_query(url, formData).then((result)=>{
                    self.decision_reason('')
                    $('#decisionModal').modal('hide');
                    $('#detailsModal').modal('hide');
                    $('#emailModal').modal('hide');
                    toastr.success("Successful", "Done", {
                        hideDuration: 3000
                    });
                    self.refresh_search()

                }, (err)=>{
                    toastr.warning(JSON.stringify(err), "Error", {
                        hideDuration: 3000
                    });
                })

            }

            self.imageModal = ko.observable('')
            self.imageOpenModal = function(src){
                self.imageModal(src)
            }

            self.view_user = function(id, view, user_type){
                
            }

            self.rating = function(data){
                if( data['total_number'] == 0)
                    return 0
                return ( ((data['total_sum'] / 5)/data['total_number']) * 100 ).toFixed(2)
            }

            self.load_dashboard  = function() {

                if(!self.loaded_dashboard()){

                    self.loaded_dashboard(true)

                    get_query(`/api/administrator/dashboard/`).then((result)=>{

                        self.agents(result.agents)
                        self.endusers(result.endusers)
                        self.enquiries(result.enquiries)
                        self.support(result.support)
                        
                    }).fail(function (response){
                        
                        toastr.warning(JSON.stringify(response), "Dashboard error", {
                            hideDuration: 3000
                        });
                    })
                }

            }

            self.get_data = function(url){
                // reset image modal
                self.imageModal('')

                get_query(url).then((result)=>{

                    self.next(result.paginator.links.next)
                    self.prev(result.paginator.links.previous)
                    self.first_page(1)
                    self.last_page(result.paginator.num_pages)

                    if(self.title() == 'Enquiries')
                        self.detail_list(result.results)
                    else
                        self.users(result.results)

                }).fail(function (response){
                    toastr.warning(JSON.stringify(response), "Data error", {
                        hideDuration: 3000
                    });
                })

            }

            self.get_data_history = function(url){

                get_query(url).then((result)=>{
                    console.log(result)
                    if(self.current_history().includes('chat'))
                        self.chat_list(result.results)
                    else
                        self.detail_list_history(result.results)
                    self.next_history(result.paginator.links.next)
                    self.prev_history(result.paginator.links.previous)
                    self.first_page_history(1)
                    self.last_page_history(result.paginator.num_pages)

                }).fail(function (response){
                    toastr.warning(JSON.stringify(response), "Data error", {
                        hideDuration: 3000
                    });
                })

            }

            self.view_history = function(id, type){
                if(type == 'chat'){
                    self.current_history(`/api/enquiries/chatlist/?id=${id}&mode=ADMIN&model=Enquiry`)
                    self.get_data_history(`/api/enquiries/chatlist/?id=${id}&mode=ADMIN&model=Enquiry`)
                }
                else {
                    self.current_history(`/api/enquiries-activity/?enquiry_id=${id}`)
                    self.get_data_history(`/api/enquiries-activity/?enquiry_id=${id}`)
                }
            }

            self.locate = function(lat, lng){
                window.open("https://www.google.com/maps/dir/?api=1&origin=" + lat + "," + lng + "&destination=" + lat+ "," + lng + "&travelmode=driving", '_blank');
            }

            self.view_management = {
                'dashboard': {
                    title: 'Dashboard',
                    sub_title: '',
                    sub_sub_title: '',
                    url:  ''
                },
                'support': {
                    title: 'Support',
                    sub_title: 'sup',
                    sub_sub_title: '',
                    url:  ''
                },
                'all-enquiries': {
                    title: 'Enquiries',
                    sub_title: 'All',
                    sub_sub_title: '',
                    url:  '/api/enquiries/'
                },
                'pending-enquiries': {
                    title: 'Enquiries',
                    sub_title: 'Pending',
                    sub_sub_title: '',
                    url:  '/api/enquiries/pending/'
                },
                'reserved-enquiries': {
                    title: 'Enquiries',
                    sub_title: 'Reserved',
                    sub_sub_title: '',
                    url:  '/api/enquiries/reserved/'
                },
                'approved-enquiries': {
                    title: 'Enquiries',
                    sub_title: 'Approved',
                    sub_sub_title: '',
                    url:  '/api/enquiries/approved/'
                },
                'referred-enquiries': {
                    title: 'Enquiries',
                    sub_title: 'Referred',
                    sub_sub_title: '',
                    url:  '/api/enquiries/referred/'
                },
                'resolved-enquiries': {
                    title: 'Enquiries',
                    sub_title: 'Resolved',
                    sub_sub_title: '',
                    url:  '/api/enquiries/resolved/'
                },
                'cancelled-enquiries': {
                    title: 'Enquiries',
                    sub_title: 'Cancelled',
                    sub_sub_title: '',
                    url:  '/api/enquiries/cancelled/'
                },
                'endusers': {
                    title: 'Users',
                    sub_title: 'Enduser',
                    sub_sub_title: '',
                    url:  '/api/enduser/'
                },
                'agents': {
                    title: 'Users',
                    sub_title: 'Agent',
                    sub_sub_title: '',
                    url:  '/api/agent/'
                },
                'view-details': {
                    title: 'Viewing Details',
                    sub_title: '',
                    sub_sub_title: '',
                    url:  ''
                },
            }
            
            // Behaviours - setting titles and getting queries
            self.update_titles = function(screen, load=true) {

                self.title(self.view_management[screen]['title']);
                self.sub_title(self.view_management[screen]['sub_title']);
                self.sub_sub_title(self.view_management[screen]['sub_sub_title']);

                // changes url after has
                location.hash = screen;

                // shows different view after click
                self.viewing(screen); 

                self.current('')
                self.detail_list([])
                self.users([])

                console.log(self.users())

                if(load){
                    
                    if(self.title() == 'Dashboard'){
                        self.load_dashboard()
                    }
                    else if(self.title() == 'Enquiries'){
                        self.current(self.view_management[screen]['url'])
                        self.get_data(self.view_management[screen]['url'])
                    }
                    else if(self.title() == 'Users'){
                        self.current(self.view_management[screen]['url'])
                        self.get_data(self.view_management[screen]['url'])
                    }

                }

            };

            // -- normal list -- //

            self.next_item = function(){
                if(self.next() != null && self.next() != undefined)
                    self.get_data(self.next())
            }

            self.prev_item = function(){
                if(self.prev() != null && self.prev() != undefined)
                    self.get_data(self.prev())
            }

            self.paginate_next = function(page){
                if( self.next() != null && self.first_page() != self.last_page() ){
                    if(self.search() != '')
                        page = page + '&search=' + self.search()
                    self.get_data(self.current() + '?page=' + page)
                }
            }

            self.paginate_prev = function(page){
                if( self.prev() != null ){
                    if(self.search() != '')
                        page = page + '&search=' + self.search()
                    self.get_data(self.current() + '?page=' + page)
                }
            }

            self.searching = function(search){
                if(search != '')
                    self.get_data(self.current()+'?search='+search)
            }

            self.refresh_search = function(){
                self.search('')
                self.get_data(self.current())
            }
            // -- end normal list -- //

            // -- history list -- //

            self.next_item_history = function(){
                if(self.next_history() != null && self.next_history() != undefined)
                    self.get_data_history(self.next_history())
            }

            self.prev_item_history = function(){
                if(self.prev_history() != null && self.prev_history() != undefined)
                    self.get_data_history(self.prev_history())
            }

            self.paginate_next_history = function(page){
                if( self.next_history() != null && self.first_page_history() != self.last_page_history() ){
                    if(self.search_history() != '')
                        page_history = page + '&search=' + self.search_history()
                    self.get_data_history(self.current_history() + '&page=' + page)
                }
            }

            self.paginate_prev_history = function(page){
                if( self.prev_history() != null ){
                    if(self.search_history() != '')
                        page_history = page + '&search=' + self.search_history()
                    self.get_data_history(self.current_history() + '&page=' + page)
                }
            }

            self.searching_history = function(search){
                if(search != '')
                    self.get_data_history(self.current_history()+'?search='+search)
            }

            self.refresh_search_history = function(){
                self.search_history('')
                self.get_data_history(self.current_history())
            }
            // -- end history list -- //


            self.viewing_details = function(data){
                self.view_details(data)
            }

            self.viewing_chats = function(id){
                
                get_query(`/api/chat/chats?id=${id}`).then((result)=>{
                    console.log(result)
                    self.chats(result)
                }).fail(function (response){
                    toastr.warning(JSON.stringify(response), "Chat error", {
                        hideDuration: 3000
                    });
                })

            }

            self.signup = function(){

                let formArray = {
                    'first_name': self.first_name(),
                    'email': self.email(),
                    'cell': self.cell(),
                    'password': self.password(),
                    'password2': self.confirm_password(),
                    'group': 'auto'
                }

                post_query(`/api/auth/register-view/`, formArray).then((result)=>{
                    self.login()
                }).fail(function (response){
                    toastr.warning(JSON.stringify(response), "Sign up error", {
                        hideDuration: 3000
                    });
                })
            }

            self.login = function(){
                let formArray = {'email' : self.email(), 'password': self.password()}
                
                post_query(`/api/available/`, formArray).then((result)=>{
                    window.location.reload()
                }).fail(function (response){
                    toastr.warning(JSON.stringify(response), "Login error", {
                        hideDuration: 3000
                    });
                })

            }

            self.logout = function(){
                const csrftoken = '{{csrf_token}}';
                
                post_query(`/api/auth/logout/`, {}).then((result)=>{
                    window.location.reload()
                }).fail(function (response){
                    toastr.warning(JSON.stringify(response), "Logout error", {
                        hideDuration: 3000
                    });
                })

            }

            self.ad_name = ko.observable(""); 
            self.ad_description = ko.observable("");
            self.ad_price = ko.observable("");
            self.ad_city = ko.observable("");
            self.ad_province = ko.observable("");
            self.ad_duration = ko.observable("");
            self.ad_term = ko.observable("");
            self.ad_latitude = ko.observable("");
            self.ad_longitude = ko.observable("");
                
            self.ad_image_1 = ko.observable("");
            self.ad_image_2 = ko.observable("");
            self.ad_image_3 = ko.observable("");
            self.ad_image_4 = ko.observable("");

            self.img_1 = ko.observable("");
            self.img_2 = ko.observable("");
            self.img_3 = ko.observable("");
            self.img_4 = ko.observable("");

            self.availableProvinces = ko.observableArray([
                {'value': 'PE', 'name': 'Port Elizabeth'},
                {'value': 'NC', 'name': 'Northern Cape'},
                {'value': 'WC', 'name': 'Western Cape'},
                {'value': 'GP', 'name': 'Gauteng'},
                {'value': 'NW', 'name': 'North West'},
                {'value': 'KZN', 'name': 'Kwa-Zulu Natal'},
                {'value': 'Mpuma', 'name': 'Mpumalanga'},
                {'value': 'PLK', 'name': 'Limpopo'},
                {'value': 'FS', 'name': 'Free State'},
            ])

            self.availableTerms = ko.observableArray([
                {'value': '0', 'name': 'Days'},
                {'value': '1', 'name': 'Weeks'},
                {'value': '2', 'name': 'Months'},
                {'value': '3', 'name': 'Years'},
            ])

            self.fileUpload = function(position){
                
                const a = document.createElement("input");
                const event = document.createEvent('MouseEvents');
                event.initEvent('click', true, true);
                a['type'] = 'file' ;
                a.dispatchEvent(event);
                
                a.addEventListener('change', (evt) => {
                    const files = evt.target.files;
                    // for (let i = 0; i < files.length; i++) {
                    //    this.items.push(files[i]);
                    // }
                    const file = evt.target.files[0];
                    const pattern = /image-*/;
                    const reader = new FileReader();

                    if (!file.type.match(pattern)) {
                    toastr.warning('File format not supported', "Upload error", {
                            hideDuration: 3000
                        });
                    return;
                    }

                    reader.onload = () => {
                        if(position == '1'){
                            self.img_1(file.name)
                            self.ad_image_1(file)
                        }
                        else if(position == '2'){
                            self.img_2(file.name)
                            self.ad_image_2(file)
                        }
                        else if(position == '3'){
                            self.img_3(file.name)
                            self.ad_image_3(file)
                        }
                        else if(position == '4'){
                            self.img_4(file.name)
                            self.ad_image_4(file)
                        }
                    };
                    reader.readAsDataURL(file);

                }, false);
            }

            self.upload_ad = function (){
                if(self.ad_name().length == 0)
                    return toastr.warning("Name is required", "Upload error", {
                        hideDuration: 3000
                    });
                if(self.ad_city().length == 0)
                    return toastr.warning("City is required", "Upload error", {
                        hideDuration: 3000
                    });
                

                const formData = new FormData();

                formData.append('user', '1'); 
                formData.append('name', self.ad_name()); 
                formData.append('description', self.ad_description()); 
                formData.append('total_price', self.ad_price()); 
                formData.append('latitude', self.ad_latitude()); 
                formData.append('longitude', self.ad_longitude()); 
                formData.append('city', self.ad_city()); 
                formData.append('province', self.ad_city()); 
                formData.append('term', self.ad_term()); 
                formData.append('duration', self.ad_duration()); 
                formData.append('mode',  'ADMIN')

                if(self.ad_image_1() != '')
                    formData.append('image_1', self.ad_image_1(), self.ad_image_1().name);
                if(self.ad_image_2() != '')
                    formData.append('image_2', self.ad_image_2(), self.ad_image_2().name);
                if(self.ad_image_3() != '')
                    formData.append('image_3', self.ad_image_3(), self.ad_image_3().name);
                if(self.ad_image_4() != '')
                    formData.append('image_4', self.ad_image_4(), self.ad_image_4().name);
                
                post_query(`/api/available/`, formData, 'file').then((result)=>{
                    self.reset()
                    toastr.success("Successful", "Upload", {
                        hideDuration: 3000
                    });
                }).fail(function (response){
                    toastr.warning(JSON.stringify(response), "Upload error", {
                        hideDuration: 3000
                    });
                })

            }

            self.reset = function(){
                self.ad_name(""); 
                self.ad_description("");
                self.ad_price("");
                self.ad_city("");
                self.ad_province("");
                self.ad_duration("");
                self.ad_term("");
                self.ad_latitude("");
                self.ad_longitude("");
                    
                self.ad_image_1("");
                self.ad_image_2("");
                self.ad_image_3("");
                self.ad_image_4("");

                self.img_1("");
                self.img_2("");
                self.img_3("");
                self.img_4("");
            }

            self.load_dashboard()
        
            // Client-side routes  
            // uses location.dash
            // #:page is   
            Sammy(function() {
                
                this.get('#:page', function() {
                    
                    $('#decisionModal').modal('hide');
                    $('#detailsModal').modal('hide');
                    $('#emailModal').modal('hide');
                    $('#imageModal').modal('hide');
                    $('#userModal').modal('hide');
                    $('#historyModal').modal('hide');
                    $('#chatListModal').modal('hide');

                    self.update_titles(this.params.page, true)
                });
                this.get('', function() {
                    self.update_titles('dashboard', false)
                });

            }).run();
        }
        
        // Activates knockout.js
        ko.applyBindings(new AdminViewModel());
    </script>
</body>

</html>